{% extends "layout.html" %}

{% block content %}
<div class="container">
    <h2 class="mb-4">{{ 'Update Book' if book else 'Add Book' }}</h2>

    <form action="{{ url_for('update_book', book_id=book.book_id) if book else url_for('add_book') }}" method="post" class="needs-validation" novalidate>
        <div class="row">
            <!-- Title -->
            <div class="col-md-6 mb-3">
                <label for="title" class="form-label">Title</label>
                <input type="text" class="form-control" id="title" name="title" value="{{ book.title if book else '' }}" required>
            </div>

            <!-- ISBN -->
            <div class="col-md-6 mb-3">
                <label for="isbn" class="form-label">ISBN</label>
                <input type="text" class="form-control" id="isbn" name="isbn" value="{{ book.isbn if book else '' }}" required>
            </div>

            <!-- Edition -->
            <div class="col-md-6 mb-3">
                <label for="edition" class="form-label">Edition</label>
                <input type="number" class="form-control" id="edition" name="edition" value="{{ book.edition if book else '' }}" required>
            </div>

            <!-- Total Copies -->
            <div class="col-md-6 mb-3">
                <label for="copies_total" class="form-label">Total Copies</label>
                <input type="number" class="form-control" id="copies_total" name="copies_total" value="{{ book.copies_total if book else '' }}" required>
            </div>

            <!-- Shelf Number -->
            <div class="col-md-6 mb-3">
                <label for="shelf_number" class="form-label">Shelf Number</label>
                <input type="text" class="form-control" id="shelf_number" name="shelf_number" value="{{ book.shelf_number if book else '' }}" required>
            </div>

            <!-- Author -->
            <div class="col-md-6 mb-3">
                <label for="author_id" class="form-label">Author</label>
                <select id="author_id" name="author_id" class="form-select" required>
                    {% for author in authors %}
                        <option value="{{ author[0] }}" {% if book and book.author_id == author[0] %} selected {% endif %}>{{ author[1] }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- Publisher -->
            <div class="col-md-6 mb-3">
                <label for="publisher_id" class="form-label">Publisher</label>
                <select id="publisher_id" name="publisher_id" class="form-select" required>
                    {% for publisher in publishers %}
                        <option value="{{ publisher[0] }}" {% if book and book.publisher_id == publisher[0] %} selected {% endif %}>{{ publisher[1] }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- Genre (Select2) -->
            <div class="col-md-6 mb-3">
                <label for="genre_id" class="form-label">Select Genre(s)</label>
                <select id="genre_id" name="genre_id[]" multiple required class="form-select select2">
                    {% for genre in genres %}
                        <option value="{{ genre[0] }}"{% if book and genre[0] in book.genre_ids %} selected {% endif %}>
                            {{ genre[1] }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <!-- Published Year -->
            <div class="col-md-6 mb-3">
                <label for="published_year" class="form-label">Year</label>
                <input type="number" class="form-control" id="published_year" name="published_year" value="{{ book.published_year if book else '' }}" required>
            </div>
        </div>

        <!-- Buttons -->
        <button type="submit" class="btn btn-primary">{{ 'Update' if book else 'Add' }} Book</button>

        {% if book %}
            <form action="{{ url_for('delete_book', book_id=book.book_id) }}" method="post" class="d-inline">
                <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this book?')">Delete</button>
            </form>
        {% endif %}
    </form>
</div>

<!-- Select2 JS -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>

<script>
    $(document).ready(function() {
        $('#genre_id').select2({
            placeholder: "Select genres",
            allowClear: true
        });
    });
</script>
{% endblock %}
