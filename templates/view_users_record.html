{% extends "layout.html" %}

{% block content %}
<h1 class="text-center">Users Record</h1>

<!-- Search Form -->
<form action="/view_users_record" method="GET" class="d-flex justify-content-end mb-3">
    <div class="me-2">
        <label for="search_type" class="form-label">Search By:</label>
        <select id="search_type" name="search_type" class="form-select">
            <option value="" {% if request.args.get('search_type') == '' %}selected{% endif %}>Select</option>
            <option value="title" {% if request.args.get('search_type') == 'title' %}selected{% endif %}>Title</option>
            <option value="username" {% if request.args.get('search_type') == 'username' %}selected{% endif %}>Username</option>
            <option value="pa_pss_number" {% if request.args.get('search_type') == 'pa_pss_number' %}selected{% endif %}>PA/PSS Number</option>
        </select>
    </div>

    <div class="me-2">
        <label for="search" class="form-label">Search:</label>
        <input type="text" id="search" name="search" class="form-control" placeholder="Enter search term..." value="{{ request.args.get('search', '') }}">
    </div>

    <div class="align-self-end">
        <button type="submit" class="btn btn-primary">Search</button>
    </div>
</form>

<!-- Users Record Table -->
<table class="table table-striped table-bordered text-center">
    <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>Username</th>
            <th>Book</th>
            <th>Issue Date</th>
            <th>Due Date</th>
            <th>Is Returned</th>
            <th>Return Date</th>
        </tr>
    </thead>
    <tbody>
        {% for view_user_record in view_users_record %}
        <tr>
            <td>{{ view_user_record.users_record_id }}</td>
            <td>{{ view_user_record.username }}</td>
            <td>{{ view_user_record.title }}</td>
            <td>{{ view_user_record.issue_date }}</td>
            <td>{{ view_user_record.due_date }}</td>
            <td>
                <form action="{{ url_for('return_book', users_record_id=view_user_record.users_record_id) }}" method="POST">
                    <select name="is_returned" class="form-select" onchange="this.form.submit()">
                        <option value="0" {% if view_user_record.is_returned == 0 %}selected{% endif %}>Not Returned</option>
                        <option value="1" {% if view_user_record.is_returned == 1 %}selected{% endif %}>Returned</option>
                    </select>
                </form>
            </td>
            <td>{{ view_user_record.return_date }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock %}
